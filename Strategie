import java.util.Arrays;
import java.util.List;
import java.util.ArrayList;

import lejos.hardware.port.MotorPort;
import lejos.hardware.port.SensorPort;
import lejos.utility.Delay;

public class Strategie{

	TouchSensor t;
	DifferentialDrive m;
	Ultrasonic uS;
	Pince p;
	ColorSensor c;

	public Strategie() {
		t = new TouchSensor(SensorPort.S4);
		m = new DifferentialDrive(MotorPort.A,MotorPort.B);
		uS = new Ultrasonic(SensorPort.S2);
		p = new Pince (MotorPort.C);
		c = new ColorSensor(SensorPort.S1);

	}

	public void premierPalet() { //avance et recupere un palet et le met derriere la ligne blanche

		System.out.println("Recherche du premier palet");

		int i=0;
		while(i<1) { //tant que i inférieur à 1
			while (! t.isPressed()){ //tant que le touch nest pas touché
				m.forward();
			}
			m.stop();
			p.Close();
			m.forward();
			if (c.getColorID()==6) { //si la couleur détecté est le blanc (6), i=1 donc on sort de la boucle
				m.stop();
				p.Open();
				i=1;
			}
		}
	}


	public void esquive() { //esquive un obstacle
		if(uS.getDistance()>30) { //si la distance est inférieur à 30, cest un obstabcle a éviter
			m.stop();
			m.rotateClockwise();

		}
	}

	public void detecte() { // le robot fait un tour sur lui même pour detecter le palet le plus proche et se place devant

		System.out.println("Mode : Detection de palet");

		List <Float> liste= new ArrayList<Float> ();
		
		m.demiTour();
		while(m.isMoving()==true) {//tant que le demi tour n'est pas fini
			float i = uS.getDistance();
			liste.add(i);
			//System.out.println(i);
		}
		
	//TODO ervoir cette methode
		int indice=0;
		float val=1000;
		for(int i=0; i<liste.size();i++) { // tant qu'on a pas parcouru toute la liste
			if(liste.get(i)>0.3 && liste.get(i)<val) { //si lindice i est inf à 0.3 et inf à val
					val=liste.get(i);
					indice=i;
					Delay.msDelay(500);
			}
		}
		System.out.print(liste.size());
		Delay.msDelay(5000);
		int angle=(int) (360/liste.size()*4.3*1000*indice);
		
		m.pivote(angle);
	}

	

	public static void main(String[] args) {
		Strategie s=new Strategie();

		s.detecte();
	}

}
